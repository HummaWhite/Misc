# H

又是看题解做的QAQ。

构造一个串使得其所含模板串的出现次数乘以权值之和最大。

涉及到多个模板串的匹配，肯定考虑AC自动机。而题意明显带有dp性质，就考虑利用AC自动机节点的转移关系来dp，这个转移关系就是trie图。

$dp[i, j]$表示长度为$i$，位于节点$j$时的最大值。枚举$j$在trie图上的所有邻接节点进行转移，即

$dp[i+1, ch[j, k]] = \max(dp[i, j] + val[ch[j, k]])$，$val[x]$为以$x$及其在fail树上祖先结尾的字符串权值和，可以在构建AC自动机的时候处理出来