# I

QAQ没有题解根本想不到做法系列。

这道题跟H题感觉有点像，都是利用AC自动机节点转移关系的字符串构造dp问题。

L 1e18摆明了是矩阵快速幂。。。就是把转移关系构造为一个叫“可达性矩阵”的东西，乘几次就得到某些点之间长度为几的路径总数。对于本题，就是根节点到其它一些点之间的路径数之和。那么就是如何构造矩阵的问题了。

题解给的是直接计算含有模板串的种数，但自己一直没想清楚“含有”的关系如何在矩阵中产生并延续的。。于是去看了看hdu2243的题解，发现都是从反面考虑问题，即用总方案数减去不含有模板串的方案数。

这种思路个人感觉好像要更清楚一点，因为对于点$u$和后续点$v$，如果到$v$不能匹配的话$A[u, v]++$

然后就是如何求等比矩阵和的问题了。。

首先想到的是
$$
\left[
\begin{matrix}
A & 0  \\
A & 1  \\
\end{matrix}
\right]^L
$$
这样要把矩阵扩大一倍，400^3 = 6e7，加上快速幂的logL，GG

之后好不容易看到了这样的方法才过的：
$$
\left[
\begin{matrix}
A & 1  \\
0 & 1  \\
\end{matrix}
\right]^{L+1}
$$
由于不明因素，矩阵写成结构体后只能开一个……逼得我直接硬刚